<script defer>
  const usedSlots = document.querySelectorAll(".slot-num-revisions")
  const fileIds = Array.from(usedSlots, el => el.closest('article').dataset.fileId)

  for (slot of usedSlots)
    slot.classList.add('throbber')

  const BATCH_SIZE = 10
  for (let i = 0; i < fileIds.length; i += BATCH_SIZE) (async () => { /* captures i */
    const slice = fileIds.slice(i, i + BATCH_SIZE)

    LOG(`Asking for revisions for ${slice.length} files`)
    const bulkRevisions = await CALL.getRevisionsInBulk(slice)

    LOG(`Yay[${i}-${i + slice.length}]!  # = ${bulkRevisions.length}`)
    bulkRevisions.forEach((revisions, j) => {
      const numRevsEl = usedSlots[i + j]
      numRevsEl.classList.remove('throbber')
      numRevsEl.innerHTML = `<b>${revisions.length}</b> of ${revisions.length} revisions`
    })
  })()

</script>